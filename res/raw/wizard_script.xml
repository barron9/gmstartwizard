<?xml version="1.0" encoding="UTF-8"?>
<!-- Copyright (C) 2014 Google Inc. All Rights Reserved. -->

<!--
    The wizard:uris recorded here have the inconvenience of being generated by hand, but they allow
    for the full spread of launch flags (we need FLAG_ACTIVITY_NEW_TASK [0x10000000]), where the
    <intent> tag processed by Intent.parseIntent() does not.

    adb shell am to-intent-uri -a com.android.setupwizard.WELCOME -f 0x10000000 \-\-ez firstRun true
-->
<WizardScript xmlns:wizard="http://schemas.android.com/apk/res/com.google.android.setupwizard"
    wizard:firstAction="oem_pre_setup">

    <!-- Preliminary setup for OEMs -->
    <WizardAction id="oem_pre_setup"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.OEM_PRE_SETUP;end">
        <result wizard:action="welcome" />
    </WizardAction>

    <!-- Welcome screen with language selection -->
    <WizardAction id="welcome"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.WELCOME;end">
        <result wizard:name="start_qr_provision"
            wizard:resultCode="101"
            wizard:action="qr_provision_flow" />
        <result wizard:name="dpm_user_complete"
            wizard:resultCode="111"
            wizard:action="oem_post_setup" />
        <result wizard:action="sim_missing" />
    </WizardAction>

    <!-- QR provision flow -->
    <WizardAction id="qr_provision_flow"
        wizard:script="android.resource://com.android.gmsetupwizard/raw/wizard_script_qr_provision_flow">
        <result wizard:action="oem_post_setup" />
    </WizardAction>

    <WizardAction id="sim_missing"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.SIM_MISSING;end">
        <result wizard:action="gm_welcome" />
    </WizardAction>

    <!-- GM Welcome Flow -->
    <WizardAction
        id="gm_welcome"
        wizard:uri="intent:#Intent;action=com.android.gmsetupwizard.GM_WELCOME;end" >
        <result wizard:action="carrier_setup" />
    </WizardAction>
	

    <!--
        Check carrier setup status (Nova).

        RESULT_OK (-1)
        RESULT_CARRIER_SETUP_NOT_READY (1)
        RESULT_CARRIER_SETUP_SKIPPED (2)
        RESULT_CARRIER_SETUP_ERROR (3)
        RESULT_ACTIVITY_NOT_FOUND (3; result code conflict!!!)
     -->
    <WizardAction id="carrier_setup"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.CARRIER_SETUP;end">
        <result wizard:action="background_activation" />
    </WizardAction>

    <WizardAction id="background_activation"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.BACKGROUND_ACTIVATION;end">
        <result wizard:action="sim_setup" />
    </WizardAction>

    <WizardAction id="sim_setup"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.SIM_SETUP;end">
        <result wizard:action="flow_choice" />
    </WizardAction>

    <!-- Choose between restoring or set up as new device -->
    <WizardAction id="flow_choice"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.FLOW_CHOICE;end">
        <result wizard:name="ok"
            wizard:resultCode="-1"
            wizard:action="restore_choice" />
        <result wizard:name="skip"
            wizard:resultCode="1"
            wizard:action="setup_as_new_flow" />
        <result wizard:action="restore_with_account_flow" />
    </WizardAction>

    <!-- Choose device restoration flow -->
    <WizardAction id="restore_choice"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.RESTORE_CHOICE;end">
        <result wizard:name="d2d"
            wizard:resultCode="101"
            wizard:action="restore_with_device_flow" />
        <result wizard:name="ios_restore"
            wizard:resultCode="102"
            wizard:action="restore_with_ios_flow" />
        <result wizard:action="restore_with_account_flow" />
    </WizardAction>

    <WizardAction id="restore_with_account_flow"
        wizard:script="android.resource://com.android.gmsetupwizard/raw/wizard_script_restore_with_account_flow">
        <result wizard:action="oem_post_setup" />
    </WizardAction>

    <WizardAction id="restore_with_device_flow"
        wizard:script="android.resource://com.android.gmsetupwizard/raw/wizard_script_restore_with_device_flow">
        <result wizard:action="oem_post_setup" />
    </WizardAction>

    <WizardAction id="restore_with_ios_flow"
        wizard:script="android.resource://com.android.gmsetupwizard/raw/wizard_script_restore_with_ios_flow">
        <result wizard:action="oem_post_setup" />
    </WizardAction>

    <WizardAction id="setup_as_new_flow"
        wizard:script="android.resource://com.android.gmsetupwizard/raw/wizard_script_setup_as_new_flow">
        <result wizard:action="oem_post_setup" />
    </WizardAction>

    <!-- OEM completion -->
    <WizardAction id="oem_post_setup"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.OEM_POST_SETUP;end">
        <result wizard:action="exit" />
    </WizardAction>

    <WizardAction id="exit"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.EXIT;end" />

</WizardScript>
